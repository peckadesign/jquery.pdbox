/*! jQuery pdBox 1.1.2-draft | MIT | PeckaDesign, s.r.o, https://github.com/peckadesign/jquery.pdbox */

$.pdBox=function(){function a(a){a=a||{},this.defaults={},this.defaults.width=k.width,this.defaults.className=k.className,a.width&&(this.defaults.width=a.width),a.className&&(this.defaults.className+=" "+a.className),this.options=$.extend({},k,a),a.template&&(this.options.template=a.template.toString()),"object"==typeof a.langs?this.langs=$.extend({},l,a.langs):this.langs=l,this.options.lang in this.langs||(this.options.lang="en"),this.isOpen=!1,this.setOnOpenOptions=!1,this.isAjax=a.isAjax||!1,this.isInner=a.isInner||!1,this.events={},this.overlay=null,this.rootElem={},this.window={},this.$doc=$(document),this.$body=$("body"),this.$html=$("html"),this.spinnerHtml=a.spinnerHtml||"<span class='pdbox__spinner'></span>",this.html="function"==typeof a.template?a.template(this):b(this),this.$el=null;var c="";for(var d in m){if(c=q(m[d]),"object"==typeof a[c])for(fn in a[c])a[c].hasOwnProperty(fn)&&"function"==typeof a[c][fn]&&this.addEventListener(m[d],a[c][fn]);else"function"==typeof a[c]&&this.addEventListener(m[d],a[c]);this.options[c]=void 0}this.addEventListener("load",function(){this.rootElem.removeClass("pdbox--loading")})}function b(a){return $content="<div class='pdbox__window'>\t<div class='pdbox__content'>\t\t<h2 class='pdbox__title'></h2>\t\t<div class='pdbox__desc'>"+(a.isAjax?"<div id='snippet--pdbox' class='pdbox__snippet'></div>":"")+"\t\t</div>\t\t<p class='pdbox__pager'>\t\t\t<a href='#' class='pdbox__page pdbox__page--prev' rel=''><span>"+a.langs[a.options.lang].prev+"</span></a>\t\t\t<span class='pdbox__pages'></span>\t\t\t<span class='pdbox__pages-summary'><span class='pdbox__active-page'></span>"+a.langs[a.options.lang].of+"<span class='pdbox__pages-count'></span></span>\t\t\t<a href='#' class='pdbox__page pdbox__page--next' rel=''><span>"+a.langs[a.options.lang].next+"</span></a>\t\t</p>\t\t<p class='pdbox__image'></p>\t\t<div class='pdbox__pager--thumbnails'></div>"+a.spinnerHtml+"\t\t<a href='#' class='pdbox__close' title='"+a.langs[a.options.lang].close+"'> "+a.langs[a.options.lang].close+"</a>\t</div></div>",$content}function c(a){a.rootElem=$('<div class="pdbox u-out"></div>'),a.rootElem.html(a.html).prependTo(a.$body),a.window.elem=a.rootElem.find(".pdbox__window"),a.window.close=a.window.elem.find(".pdbox__close"),a.window.title=a.window.elem.find(".pdbox__title"),a.window.content=a.window.elem.find(".pdbox__content"),a.window.descWrap=a.window.elem.find(".pdbox__desc"),a.window.desc=a.window.elem.find(".pdbox__snippet"),a.window.desc.length||(a.window.desc=a.window.descWrap),a.window.pager={elem:a.window.elem.find(".pdbox__pager"),pages:a.window.elem.find(".pdbox__pages"),pagesSummary:a.window.elem.find(".pdbox__pages-summary"),activePage:a.window.elem.find(".pdbox__active-page"),pagesCount:a.window.elem.find(".pdbox__pages-count"),prev:a.window.elem.find(".pdbox__page--prev"),next:a.window.elem.find(".pdbox__page--next"),thumbnails:a.window.elem.find(".pdbox__pager--thumbnails")},a.window.image=a.window.elem.find(".pdbox__image"),$(document).on("click.pdbox",".pdbox__close, .pdbox__close--alternative",$.proxy(j,a)),a.$doc.on("keyup.pdbox",$.proxy(g,a)),a.window.image.on("click.pdbox",$.proxy(function(a){this.close(),a.preventDefault()},a))}function d(a){a.window.close.off(),a.window.pager.next.off(),a.window.pager.prev.off(),a.window.pager.pages.find("a").off(),a.window.pager.thumbnails.off(),a.window.image.off(),a.overlay.off(),a.$doc.off("keyup.pdbox"),a.rootElem.remove()}function e(a,b,c){var d=b.data("rel");if(d){var e=$(c),g=$([]),i=e.filter('[data-rel="'+d+'"]'),j="";if(i.each(function(a){j+=" <a href='"+this.href+"' class='pdbox__page'>"+(a+1)+"</a> "}),a.window.pager.pages.empty().append(j),a.options.imageThumbnails){var k="";i.each(function(a){k+="<li class='pdbox__thumbnail-item'><a href='"+this.href+"' class='pdbox__thumbnail-link'><img class='pdbox__thumbnail' src='"+$(this).data("pdbox-thumbnail")+"'></a>"}),a.window.pager.thumbnails.append($('<ul class="pdbox__thumbnail-list"/>')).find(".pdbox__thumbnail-list").append(k),a.window.pager.thumbnails.show(),g=a.window.pager.thumbnails.find("a")}else a.window.pager.thumbnails.hide();$numbers=a.window.pager.pages.find("a"),$numbers.on("click.pdbox",function(b){var c=$(this),d=$numbers.index(this);$numbers.removeClass("pdbox__page--active"),c.addClass("pdbox__page--active"),g.length&&(g.removeClass("pdbox__thumbnail-link--active"),g.eq(d).addClass("pdbox__thumbnail-link--active")),a.window.pager.activePage.text(d+1),0===d?a.window.pager.prev.addClass("pdbox__page--disabled"):a.window.pager.prev.removeClass("pdbox__page--disabled"),d===$numbers.length-1?a.window.pager.next.addClass("pdbox__page--disabled"):a.window.pager.next.removeClass("pdbox__page--disabled"),f(a,this.href,i.eq(d)),b.preventDefault()}).eq(i.index(b)).trigger("click.pdbox"),g.length&&g.on("click.pdbox",function(a){a.preventDefault(),$numbers.eq(g.index(this)).trigger("click.pdbox")}),a.window.pager.prev.on("click.pdbox",function(b){b.preventDefault(),a.window.pager.pages.find(".pdbox__page--active").prev().trigger("click.pdbox")}),a.window.pager.next.on("click.pdbox",function(b){b.preventDefault(),a.window.pager.pages.find(".pdbox__page--active").next().trigger("click.pdbox")}),a.$doc.on("keyup.pdbox",$.proxy(h,a)),$numbers.length>1&&(a.window.pager.elem.show(),a.window.pager.pagesCount.text($numbers.length))}}function f(a,b,c){var d=$("img",c),e=d.attr("alt")||c.attr("title"),f=d.attr("title")||"";a.rootElem.addClass("pdbox--loading"),e?a.window.title.show().text(e):a.window.title.hide(),f?(a.window.descWrap.show(),a.window.desc.html("<p>"+f+"</p>")):a.window.descWrap.hide();var g=c.data("pdbox-video");preloader=document.createElement(g?"iframe":"img"),$(preloader).on("load insert",function(b){(!g&&"load"===b.type||g&&"insert"===b.type)&&a.window.image[g?"addClass":"removeClass"]("pdbox__video").html(this).show(),"load"===b.type&&a.dispatchEvent("load",{content:preloader})}),$(preloader).attr("src",b),g&&$(preloader).attr({allowfullscreen:!0,width:a.options.width,height:a.options.width/(16/9)}).triggerHandler("insert")}function g(a){27===a.which&&this.close()}function h(a){37===a.which?this.window.pager.prev.not(".pdbox__page--disabled").trigger("click"):39===a.which&&this.window.pager.next.not(".pdbox__page--disabled").trigger("click"),a.preventDefault()}function i(a){a.overlay=$('<div class="pdbox__overlay"></div>').prependTo(a.rootElem)}function j(a){var b=$(a.target).closest("a");(a.target===this.window.elem[0]||this.window.elem.has(a.target).length&&(b.hasClass("pdbox__close")||b.hasClass("pdbox__close--alternative")))&&(this.close(),a.preventDefault())}var k={width:900,className:"",lang:$("html").attr("lang")||"cs"},l={cs:{close:"Zavřít",prev:"Předchozí",next:"Další",of:"/"},sk:{close:"Zavrieť",prev:"Predchádzajúca",next:"Ďalšie",of:"/"},en:{close:"Close",prev:"Previous",next:"Next",of:"/"},de:{close:"Zumachen",prev:"Vorige",next:"Folgend",of:"/"},es:{close:"Vaer",prev:"Previo",next:"Siguiente",of:"/"},fr:{close:"Fermer",prev:"Précédant",next:"Suivant",of:"/"},it:{close:"Chiudere",prev:"Previo",next:"Veniente",of:"/"},ru:{close:"закрыть",prev:"Предшествующий",next:"Последующий",of:"/"}},m=["beforeOpen","afterOpen","load","beforeClose","afterClose"];a.prototype.open=function(a,b,d){this.$el=a,this.isOpen?this.removeEventListener("load",this.setOptions):(this.isOpen=!0,this.setOnOpenOptions=!0,this.dispatchEvent("beforeOpen",{element:a}),c(this),i(this),d||this.rootElem.addClass("pdbox--loading"),this.isInner&&this.rootElem.addClass("pdbox--inner"),this.setOptions(),this.setOnOpenOptions=!1),this.addEventListener("load",this.setOptions),this.window.elem.on("click",$.proxy(j,this)),this.$body.addClass("pdbox-open"),this.window.pager.elem.hide(),this.window.pager.thumbnails.hide(),this.window.image.hide(),this.window.title.hide(),void 0!==a&&void 0!==b&&a.is(":not(.ajax)")&&e(this,a,b),this.dispatchEvent("afterOpen",{element:a})},a.prototype.close=function(){this.isOpen&&(this.isOpen=!1,this.$el=null,this.removeEventListener("load",this.setOptions),this.dispatchEvent("beforeClose"),this.window.elem.off(),d(this),this.isInner||this.$body.removeClass("pdbox-open"),this.dispatchEvent("afterClose"))},a.prototype.content=function(a){if(void 0===a){var b=this.window.elem.clone();return b.find(".ajax-overlay, .ajax-loader").remove(),b.html()}this.window.elem.html(a),this.window.content=this.window.elem.find(".pdbox__content")},a.prototype.setOptions=function(a){var b,c,d;if(this.setOnOpenOptions){$.extend(this.options,this.defaults);for(b in m)c=q(m[b]),this.options[c]=null}if(this.$el){var e={};e.width=this.$el.data("pdboxWidth"),e.className=this.$el.data("pdboxClassName")?this.$el.data("pdboxClassName")+" "+this.defaults.className:this.defaults.className;for(b in m)d=p(m[b]),c=q(m[b]),e[c]=this.$el.data(d);$.extend(this.options,e)}a&&$.extend(this.options,a),this.rootElem.removeClass(function(a,b){return b.split(" ").filter(function(a){return"pdbox"!==a&&"pdbox--loading"!==a}).join(" ")}).addClass("pdbox").addClass(this.options.className),this.window.content.css({"max-width":this.options.width+"px"})};var n=function(a){a in this.events||(this.events[a]=[])};a.prototype.addEventListener=function(a,b){n.call(this,a),this.events[a].push(b)},a.prototype.removeEventListener=function(a,b){n.call(this,a),void 0===a?this.events={}:this.events[a]=$.grep(this.events[a],function(a){return void 0!==b&&a!==b})},a.prototype.dispatchEvent=function(a,b){n.call(this,a);for(var c=0;c<this.events[a].length;c++)this.events[a][c].call(this,b);var d=q(a);if(this.options[d]){var e=o(this.options[d],window);null!==e&&e(b)}};var o=function(a,b){for(var c=a.split("."),d=b,e=0;e<c.length;e++){if(!(c[e]in d))return null;d=d[c[e]]}return d},p=function(a){return"pdboxOn"+a.charAt(0).toUpperCase()+a.slice(1)},q=function(a){return"on"+a.charAt(0).toUpperCase()+a.slice(1)};return a.prototype.openHtml=function(a,b){var c=b.data("pdbox-title");this.open(b,void 0,!0),this.window.descWrap.show(),this.window.desc.html(a),c?this.window.title.show().text(c):this.window.title.hide(),this.dispatchEvent("load",{content:a})},a.prototype.openUrl=function(a,b){this.open(b,void 0,!1),$.ajax({url:a,success:$.proxy(function(a){this.window.descWrap.show(),this.window.desc.html(a),this.dispatchEvent("load",{content:a})},this)})},a}();